<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crown Heights Property Estimator</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.css" />
</head>
<body>
    <div class="container">
        <h1>Crown Heights Property Estimator</h1>
        <p style="color: #666; margin-bottom: 20px;">Dynamic property valuation calculator with comparable analysis</p>

        <!-- Target Property Section -->
        <h2>Target Property</h2>
        <div class="target-property">
            <select id="target-property-select" onchange="changeTargetProperty()" style="margin-bottom: 15px; padding: 8px 12px; border-radius: 6px; border: 1px solid #3498db; background: white; color: #2c3e50; font-size: 14px; cursor: pointer;">
                <option value="0">Select a property...</option>
            </select>
            <h3 id="target-address">Loading...</h3>
            <div class="property-grid" id="target-property-fields"></div>
        </div>

        <!-- Estimates Section -->
        <div class="estimates-section">
            <h2 style="margin-top: 0; border: none;">Estimated Sale Price</h2>
            <div class="weighting-buttons" style="margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 8px;">
                <button class="weight-btn active" data-method="simple" onclick="setWeightingMethod('simple')" style="background-color: #6c757d;">Simple Average</button>
                <button class="weight-btn" data-method="price" onclick="setWeightingMethod('price')" style="background-color: #28a745;">Price-Weighted</button>
                <button class="weight-btn" data-method="size" onclick="setWeightingMethod('size')" style="background-color: #3498db;">Building Size</button>
                <button class="weight-btn" data-method="total-size" onclick="setWeightingMethod('total-size')" style="background-color: #9b59b6;">Total Property Size</button>
                <button class="weight-btn" data-method="date" onclick="setWeightingMethod('date')" style="background-color: #e67e22;">Date-Weighted</button>
                <button class="weight-btn" data-method="renovated" onclick="setWeightingMethod('renovated')" style="background-color: #e91e63;">Renovated</button>
                <button class="weight-btn" data-method="combined" onclick="setWeightingMethod('combined')" style="background-color: #8e44ad;">Combined (Reno+Details)</button>
                <button class="weight-btn" data-method="all-weighted" onclick="setWeightingMethod('all-weighted')" style="background-color: #16a085;">All-Weighted Blend</button>
            </div>
            <div id="estimates-container"></div>
            
            <h3>Reference Values</h3>
            <div class="reference-values" id="reference-values"></div>
        </div>

        <!-- Market Averages -->
        <h2>Market Averages</h2>
        <div class="market-averages" id="market-averages"></div>

        <!-- Map View -->
        <h2>Map View</h2>
        <div class="map-container">
            <div class="map-controls">
                <button id="map-markers-btn" class="map-control-btn active" onclick="showMapMarkers()">Markers</button>
                <button id="map-heatmap-btn" class="map-control-btn" onclick="showMapHeatmap()">Heat Map</button>
                <select id="heatmap-metric" onchange="updateHeatmap()" style="margin-left: 10px;">
                    <option value="buildingPriceSQFT">Building $ SQFT</option>
                    <option value="totalPriceSQFT">Total $ SQFT</option>
                    <option value="salePrice">Sale Price</option>
                </select>
                <label style="margin-left: 20px; display: flex; align-items: center; gap: 5px; cursor: pointer;">
                    <input type="checkbox" id="amenities-overlay" onchange="toggleAmenitiesOverlay()" style="cursor: pointer;">
                    <span>Show Amenities Overlay</span>
                </label>
            </div>
            <div id="map" style="height: 400px; width: 100%; border-radius: 8px;"></div>
            <div id="map-status" style="margin-top: 10px; color: #666; font-size: 14px;"></div>
        </div>

        <!-- Comparable Properties -->
        <h2>Comparable Properties</h2>
        <div class="quick-filters">
            <button onclick="selectAllComps()">Select All</button>
            <button onclick="deselectAllComps()">Deselect All</button>
            <button onclick="filterRenovated()">Only Renovated</button>
            <button onclick="filterTaxClass1()">Only Tax Class 1</button>
        </div>
        <div class="comps-table-wrapper">
            <table id="comps-table">
                <thead>
                    <tr>
                        <th class="checkbox-cell">Include</th>
                        <th class="checkbox-cell">Direct<br>Comp</th>
                        <th>Address</th>
                        <th>Renovated</th>
                        <th>Property SQFT</th>
                        <th>Building SQFT</th>
                        <th>Building $ SQFT</th>
                        <th>Total $ SQFT</th>
                        <th>Sale Price</th>
                        <th id="weight-header">Weight %</th>
                        <th>Sale Date</th>
                        <th>Tax Class</th>
                        <th>Occupancy</th>
                    </tr>
                </thead>
                <tbody id="comps-tbody"></tbody>
            </table>
        </div>
    </div>

    <footer style="text-align: center; padding: 30px 20px; color: #999; font-size: 13px; border-top: 1px solid #e0e0e0; margin-top: 40px;">
        <p>Built with assistance from <strong>GitHub Copilot</strong> (Claude Sonnet 4.5)</p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <script type="module" src="calculator.js"></script>
</body>
</html>
