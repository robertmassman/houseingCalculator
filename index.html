<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crown Heights Property Estimator</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.css" />
</head>
<body>
    <div class="container">
        <h1>Crown Heights Property Estimator</h1>
        <p style="color: #666; margin-bottom: 20px;">Dynamic property valuation calculator with comparable analysis</p>
        
       <!-- <h2>Update Target</h2>
        <select id="target-property-select" onchange="changeTargetProperty()"
            style="margin-bottom: 15px; padding: 8px 12px; border-radius: 6px; border: 1px solid #3498db; background: white; color: #2c3e50; font-size: 14px; cursor: pointer;">
            <option value="0">Select a property...</option>
        </select> -->

        <!-- Target Property Section -->
        <h2>Target Property</h2>
        <div class="target-property">
            
            <!--<h3 id="target-address">Loading...</h3> -->
            <select id="target-property-select" onchange="changeTargetProperty()"
                style="margin-bottom: 15px; padding: 8px 12px; border-radius: 6px; border: 1px solid #3498db; background: white; color: #2c3e50; font-size: 14px; cursor: pointer;">
                <option value="0">Select a property...</option>
            </select>
            <div class="property-grid" id="target-property-fields"></div>
        </div>

        <!-- Estimates Section -->
        <div class="estimates-section">
            <h2 style="margin-top: 0; border: none;">Estimated Sale Price</h2>
            
            <!-- Appreciation Rate Control -->
            <!-- <div style="margin-bottom: 15px; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #3498db;">
                <label style="display: flex; align-items: center; gap: 10px; font-weight: 500; color: #2c3e50;">
                    <span style="min-width: 180px;">Annual Appreciation Rate:</span>
                    <input type="number" id="appreciation-rate" value="5.0" min="0" max="20" step="0.5" 
                           onchange="setAppreciationRate(this.value)" 
                           style="width: 80px; padding: 6px 10px; border: 1px solid #bdc3c7; border-radius: 4px; font-size: 14px;">
                    <span style="font-size: 14px; color: #7f8c8d;">% (adjusts older comp sales to today's value)</span>
                </label>
            </div> -->
            
            <!-- <div class="weighting-buttons" style="margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 8px;">
                <button class="weight-btn" data-method="simple" onclick="setWeightingMethod('simple')" style="background-color: #6c757d;">Simple Average</button>
                <button class="weight-btn" data-method="price" onclick="setWeightingMethod('price')" style="background-color: #28a745;">Price-Weighted</button>
                <button class="weight-btn" data-method="size" onclick="setWeightingMethod('size')" style="background-color: #3498db;">Building Size</button>
                <button class="weight-btn" data-method="date" onclick="setWeightingMethod('date')" style="background-color: #e67e22;">Date-Weighted</button>
                <button class="weight-btn" data-method="renovated" onclick="setWeightingMethod('renovated')" style="background-color: #e91e63;">Renovated</button>
                <button class="weight-btn" data-method="combined" onclick="setWeightingMethod('combined')" style="background-color: #8e44ad;">Combined (Reno+Details)</button>
                <button class="weight-btn" data-method="all-weighted" onclick="setWeightingMethod('all-weighted')" style="background-color: #16a085;">All-Weighted Blend</button>
            </div> -->

            <div id="estimates-container"></div>
            
            <h3>Direct Comp Reference Values</h3>
            <div class="reference-values" id="reference-values"></div>
        </div>

        <!-- Market Averages -->
        <h2>Market Averages</h2>
        <div class="market-averages" id="market-averages"></div>

        <!-- Map View -->
        <h2>Map View</h2>
        <div class="map-container">
            <div class="map-controls">
                <button id="map-heatmap-btn" class="map-control-btn" onclick="showMapHeatmap()">Weights Influence</button>
                <button id="map-value-zones-btn" class="map-control-btn" onclick="showMapValueZones()">Value Zones</button>
                <button id="map-amenities-btn" class="map-control-btn" onclick="toggleAmenitiesOverlay()">Amenities</button>
            </div>
            <div id="map" style="height: 400px; width: 100%; border-radius: 8px;"></div>
            <div id="map-popup-container" style="margin-top: 10px; display: none;"></div>
            <div id="map-legend-container" style="margin-top: 10px;"></div>
            <div id="map-status" style="margin-top: 10px; color: #666; font-size: 14px;"></div>
        </div>

        <!-- Comparable Properties -->
        <h2>Comparable Properties</h2>

        <div class="comps-table-wrapper">
            <table id="comps-table">
                <thead>
                    <tr>
                        <th class="checkbox-cell">Include</th>
                        <th class="checkbox-cell">Direct<br>Comp</th>
                        <th>Address</th>
                        <th>Reno</th>
                        <th>Lot<br> (W√óD)</th>
                        <th>Building<br>(W√óD√óFl)</th>
                        <th>Building<br> SQFT</th>
                        <th title="Price per square foot (building basis). Hover for total property $/SQFT">$/SQFT</th>
                        <th>Sale Price</th>
                        <th id="weight-header">Weight %</th>
                        <th class="similarity-header" title="Similarity score: lower is better. Based on regression model (R¬≤=96.6%). Weighs: location (commercial 2x transit), building size, lot size, renovation status, and recency. < 15 = Excellent, < 30 = Good, < 50 = Fair">Similarity</th>
                    </tr>
                </thead>
                <tbody id="comps-tbody"></tbody>
            </table>
        </div>
        
        <!-- Methodology Info -->
        <!-- <div class="info-section" style="background: #e8f5e9; padding: 12px; border-radius: 6px; margin: 30px 0 15px 0; border-left: 4px solid #4caf50;">
            <h3 style="margin: 0 0 8px 0; color: #2e7d32; font-size: 15px;">üìä Appreciation Methodology</h3>
            <p style="margin: 0; color: #33691e; font-size: 12px; line-height: 1.5;">Uses Crown Heights historical data (2019-2025) to adjust older sales. Recent sales (&lt;6mo): no adjustment. Short-term (&lt;2yr): linear. Long-term: year-by-year compounding. Sources: Zillow ZHVI, StreetEasy, NYC DOF.</p>
        </div> -->
        
        <!-- <div class="info-section" style="background: #e3f2fd; padding: 12px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #2196f3;">
            <h3 style="margin: 0 0 8px 0; color: #1565c0; font-size: 15px;">üéØ Calibrated Blending</h3>
            <p style="margin: 0; color: #0d47a1; font-size: 12px; line-height: 1.5;">Automatically optimizes building/land split (60-80% / 20-40%) by testing ratios against your selected comparables to minimize prediction error.</p>
        </div>
    </div> -->

    <!-- Disclaimer -->
    <!-- <div class="disclaimer" style="background: #fff3cd; padding: 12px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #f0ad4e;">
        <strong style="color: #8a6d3b;">‚ö†Ô∏è DISCLAIMER:</strong>
        <p style="margin: 8px 0 0 0; color: #6c5d3b; font-size: 12px; line-height: 1.5;">
            <strong>Preliminary estimates only.</strong> Not professional appraisals. Data may contain errors. Does not account for property condition, market conditions, or unique features. For official valuations, consult a licensed appraiser, broker, or attorney. Use for research purposes only.
        </p>
    </div>-->

    <footer style="text-align: center; padding: 30px 20px; color: #999; font-size: 13px; border-top: 1px solid #e0e0e0; margin-top: 40px;">
        <p>Built with assistance from <strong>GitHub Copilot</strong> (Claude Sonnet 4.5)</p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <script type="module" src="calculator.js"></script>
</body>
</html>
